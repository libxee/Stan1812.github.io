<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="Shady"><title>Hooks at a Glance Â· Libx</title><meta name="description" content="åœ¨çœ‹äº†React Hooksçš„æ–‡æ¡£ä¹‹åï¼Œæœ¬è‹±è¯­æ¸£æ¸£ç«Ÿç„¶çªç„¶æœ‰äº†æƒ³è¦ç¿»è¯‘ä¸€ä¸‹è¿™ç¯‡æ–‡æ¡£çš„å†²åŠ¨ï¼Œäºæ˜¯å°±é¦–æ¬¡å°è¯•ç¿»è¯‘ä¸€ç¯‡è‹±æ–‡æ–‡æ¡£,åŸæ–‡Hooks at a Glance
Hooksæ˜¯ä¸€ä¸ªReactä¸­çš„æ–°ææ¡ˆï¼Œä»–å¯ä»¥è®©ä½ åœ¨ä¸ä½¿ç”¨Classçš„æƒ…å†µä¸‹ä½¿ç”¨stateå’Œå…¶ä»–çš„Reactç‰¹æ€§ã€‚Hooks ç›®å‰å·²ç»å‘å¸ƒåœ¨"><meta name="keywords"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><h3 title=""><a href="/">Libx</a></h3><div class="description"><p>Thoughts,stories and ideas</p></div></div></div><ul class="social-links"></ul><div class="footer"><a target="_blank" href="/"><span>Â© 2017 â€” 2018 â¤ Shady</span></a></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">Home</a></li><li><a href="/about">Sobre</a></li><li><a href="/archives">Arquivo</a></li></div><div class="information"><div class="back_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li></div><div class="avatar"><img></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>Hooks at a Glance</a></h3></div><div class="post-content"><p>åœ¨çœ‹äº†React Hooksçš„æ–‡æ¡£ä¹‹åï¼Œæœ¬è‹±è¯­æ¸£æ¸£ç«Ÿç„¶çªç„¶æœ‰äº†æƒ³è¦ç¿»è¯‘ä¸€ä¸‹è¿™ç¯‡æ–‡æ¡£çš„å†²åŠ¨ï¼Œäºæ˜¯å°±é¦–æ¬¡å°è¯•ç¿»è¯‘ä¸€ç¯‡è‹±æ–‡æ–‡æ¡£,åŸæ–‡<a href="https://reactjs.org/docs/hooks-overview.html" target="_blank" rel="external">Hooks at a Glance</a></p>
<p>Hooksæ˜¯ä¸€ä¸ªReactä¸­çš„æ–°ææ¡ˆï¼Œä»–å¯ä»¥è®©ä½ åœ¨ä¸ä½¿ç”¨Classçš„æƒ…å†µä¸‹ä½¿ç”¨stateå’Œå…¶ä»–çš„Reactç‰¹æ€§ã€‚Hooks ç›®å‰å·²ç»å‘å¸ƒåœ¨ v16.7.0 alpha ç‰ˆæœ¬ï¼Œä¸”æ­£åœ¨å¼€æ”¾çš„<a href="https://github.com/reactjs/rfcs/pull/68" target="_blank" rel="external">RFC</a>è®¨è®ºã€‚</p>
<p>Hooksæ˜¯å‘åå…¼å®¹çš„ï¼Œè¿™ç¯‡æ–‡æ¡£å°†å‘æœ‰ç»éªŒçš„Reactå¼€å‘è€…æä¾›ä¸€ä¸ªæ¦‚è§ˆã€‚</p>
<h2 id="ğŸ“Œ-State-Hook"><a href="#ğŸ“Œ-State-Hook" class="headerlink" title="ğŸ“Œ State Hook"></a>ğŸ“Œ State Hook</h2><p>è¿™æ˜¯ä¸€ä¸ªè®¡æ•°å™¨çš„ä¾‹å­ï¼Œç‚¹å‡»æŒ‰é’®ï¼Œæ•°å­—åŠ ä¸€ã€‚<br><figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Example</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="comment">// Declare a new state variable, which we'll call "count"</span></div><div class="line">  <span class="keyword">const</span> [count, setCount] = useState(<span class="number">0</span>);</div><div class="line">  <span class="keyword">return</span> (</div><div class="line">    &lt;div&gt;</div><div class="line">      &lt;p&gt;You clicked &#123;count&#125; times&lt;<span class="regexp">/p&gt;</span></div><div class="line"><span class="regexp">      &lt;button onClick=&#123;() =&gt; setCount(count + 1)&#125;&gt;</span></div><div class="line"><span class="regexp">        Click me</span></div><div class="line"><span class="regexp">      &lt;/</span>button&gt;</div><div class="line">    &lt;<span class="regexp">/div&gt;</span></div><div class="line"><span class="regexp">  );</span></div><div class="line"><span class="regexp">&#125;</span></div></pre></td></tr></table></figure></p>
<p>åœ¨è¿™é‡Œï¼Œ<code>useState</code>æ˜¯ä¸€ä¸ªHook(æˆ‘ä»¬ç¨åä¼šè®¨è®ºå®ƒæ˜¯ä»€ä¹ˆæ„æ€)ï¼Œæˆ‘ä»¬åœ¨ä¸€ä¸ªå‡½æ•°å¼ç»„ä»¶ä¸­è°ƒç”¨å®ƒæ¥æ·»åŠ ä¸€äº›å†…éƒ¨çš„çŠ¶æ€ã€‚React<br>å°†åœ¨é‡æ–°æ¸²æŸ“é—´ä¿ç•™æ­¤çŠ¶æ€ï¼Œ<code>useState</code>è¿”å›ä¸€ä¸ªpair:åŒ…å«äº†å½“å‰çš„çŠ¶æ€å€¼å’Œä¸€ä¸ªå¯ä»¥ç”¨æ¥æ›´æ–°è¯¥å€¼çš„å‡½æ•°ã€‚ä½ å¯ä»¥åœ¨ä¸€ä¸ªäº‹ä»¶ç›‘å¬å™¨æˆ–è€…å…¶ä»–åœ°æ–¹è°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚å®ƒå’ŒClassä¸­çš„<code>setState</code>æ˜¯ç±»ä¼¼çš„ï¼Œä¸è¿‡ä»–æ²¡æŠŠæ–°æ—§çŠ¶æ€åˆå¹¶åœ¨ä¸€èµ·ã€‚ï¼ˆç¨åä¼šæœ‰ä¾‹å­æ¥æ¯”è¾ƒåœ¨ä½¿ç”¨State Hooksæ—¶useStateå’Œthis.stateçš„å·®å¼‚ï¼‰</p>
<p>useStateåªæœ‰ä¸€ä¸ªå‚æ•°ä½œä¸ºä»–çš„åˆå§‹çŠ¶æ€ï¼Œåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œè¿™ä¸ªå‚æ•°æ˜¯0ï¼Œå› ä¸ºè®¡æ•°å™¨ä»0å¼€å§‹ã€‚è¯·æ³¨æ„ï¼Œå’Œthis.stateä¸åŒçš„æ˜¯ï¼Œè¿™é‡Œçš„stateä¸ä¸€å®šéè¦æ˜¯ä¸€ä¸ªå¯¹è±¡â€”â€”ä½ è¦æ˜¯æƒ³é‚£ä¹Ÿè¡Œã€‚åˆå§‹çŠ¶æ€åªåœ¨é¦–æ¬¡æ¸²æŸ“æ—¶ä½¿ç”¨ã€‚</p>
<h3 id="å£°æ˜å¤šä¸ªçŠ¶æ€å˜é‡"><a href="#å£°æ˜å¤šä¸ªçŠ¶æ€å˜é‡" class="headerlink" title="å£°æ˜å¤šä¸ªçŠ¶æ€å˜é‡"></a>å£°æ˜å¤šä¸ªçŠ¶æ€å˜é‡</h3><p>ä½ å¯ä»¥åœ¨ä¸€ä¸ªç»„ä»¶ä¸­å¤šæ¬¡ä½¿ç”¨State Hook<br><figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">ExampleWithManyStates</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="comment">// Declare multiple state variables!</span></div><div class="line">  <span class="keyword">const</span> [age, setAge] = useState(<span class="number">42</span>);</div><div class="line">  <span class="keyword">const</span> [fruit, setFruit] = useState(<span class="string">'banana'</span>);</div><div class="line">  <span class="keyword">const</span> [todos, setTodos] = useState([&#123; <span class="attr">text</span>: <span class="string">'Learn Hooks'</span> &#125;]);</div><div class="line">  <span class="comment">// ...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>æ•°ç»„è§£æ„è¯­æ³•å…è®¸æˆ‘ä»¬ä¸ºé€šè¿‡è°ƒç”¨useStateå£°æ˜çš„çŠ¶æ€å˜é‡èµ‹äºˆä¸åŒçš„åç§°,è¿™äº›åå­—å¹¶ä¸æ˜¯useStateè¿™ä¸ªAPIçš„ä¸€éƒ¨åˆ†ï¼Œç›¸åï¼ŒReactå‡å®šå¦‚æœå¤šæ¬¡è°ƒç”¨useStateï¼Œå°±åœ¨æ¯æ¬¡æ¸²æŸ“æœŸé—´ä»¥ç›¸åŒçš„é¡ºåºæ‰§è¡Œã€‚æˆ‘ä»¬ç¨åä¼šè®¨è®ºè¿™ä»€ä¹ˆæ—¶å€™æœ‰ç”¨ã€‚</p>
<h3 id="ä½†åˆ°åº•ä»€ä¹ˆæ˜¯Hookå‘¢ï¼Ÿ"><a href="#ä½†åˆ°åº•ä»€ä¹ˆæ˜¯Hookå‘¢ï¼Ÿ" class="headerlink" title="ä½†åˆ°åº•ä»€ä¹ˆæ˜¯Hookå‘¢ï¼Ÿ"></a>ä½†åˆ°åº•ä»€ä¹ˆæ˜¯Hookå‘¢ï¼Ÿ</h3><p>Hooks æ˜¯ä¸€ä¸ªReact å‡½æ•°ç»„ä»¶å†…ä¸€ç±»ç‰¹æ®Šçš„å‡½æ•°ï¼ˆé€šå¸¸ä»¥ â€œuseâ€ å¼€å¤´ï¼Œæ¯”å¦‚ â€œuseStateâ€ï¼‰ï¼Œä½¿å¼€å‘è€…èƒ½å¤Ÿåœ¨ function component é‡Œ â€˜hook inâ€™ state å’Œ life-cyclesï¼Œä»¥åŠä½¿ç”¨ custom hook å¤ç”¨ä¸šåŠ¡é€»è¾‘ã€‚Hooksåœ¨Classç»„ä»¶ä¸­ä¸èƒ½ä½¿ç”¨-è¿™ä½¿å¾—ä½ å¯ä»¥åœ¨ä¸å†™Classçš„æƒ…å†µä¸‹ä½¿ç”¨Reactï¼ˆæˆ‘ä»¬ä¸å»ºè®®æ‚¨åœ¨ä¸€å¤œä¹‹é—´é‡å†™ç°æœ‰ç»„ä»¶ï¼Œä½†å¦‚æœæ‚¨æ„¿æ„ï¼Œå¯ä»¥å¼€å§‹åœ¨æ–°ç»„ä»¶ä¸­ä½¿ç”¨Hookã€‚ï¼‰<br>Reactæä¾›äº†ä¸€äº›åƒuseStateè¿™æ ·çš„å†…ç½®Hookã€‚ä½ è¿˜å¯ä»¥åˆ›å»ºcustom Hookä»¥åœ¨ä¸åŒç»„ä»¶ä¹‹é—´é‡ç”¨æœ‰çŠ¶æ€è¡Œä¸ºã€‚æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹å†…ç½®çš„Hooksã€‚</p>
<h2 id="âš¡ï¸-Effect-Hook"><a href="#âš¡ï¸-Effect-Hook" class="headerlink" title="âš¡ï¸ Effect Hook"></a>âš¡ï¸ Effect Hook</h2><p>ä½ ä¹‹å‰å¯èƒ½åœ¨Reactç»„ä»¶æ‰§è¡Œæ•°æ®è·å–ï¼Œè®¢é˜…æˆ–æ‰‹åŠ¨æ›´æ”¹DOMã€‚æˆ‘ä»¬ç§°è¿™ç§æ“ä½œä¸ºâ€œside effectsâ€å› ä¸ºå®ƒä»¬ä¼šå½±å“å…¶ä»–çš„ç»„ä»¶ï¼Œå¹¶ä¸”ä¸ä¼šåœ¨æ¸²æŸ“æœŸé—´å°±å®Œæˆã€‚</p>
<p>Effect Hookï¼š<code>useEffect</code>ä¸ºå‡½æ•°ç»„ä»¶å¢æ·»äº†æ‰§è¡Œside effectsçš„èƒ½åŠ›ã€‚å®ƒä¸React Classä¸­çš„componentDidMountï¼ŒcomponentDidUpdateå’ŒcomponentWillUnmountå…·æœ‰ç›¸åŒçš„ç”¨é€”ï¼Œä½†ç»Ÿä¸€ä¸ºå•ä¸ªAPIã€‚ ï¼ˆæˆ‘ä»¬å°†åœ¨ä½¿ç”¨Effect Hookæ—¶æ˜¾ç¤ºå°†useEffectä¸è¿™äº›æ–¹æ³•è¿›è¡Œæ¯”è¾ƒçš„ç¤ºä¾‹ã€‚ï¼‰</p>
<p>ä¸¾ä¸ªæ —å­ï¼Œè¿™ä¸ªç»„ä»¶åœ¨Reactæ›´æ–°DOMä¹‹åè®¾ç½®æ–‡æ¡£æ ‡é¢˜ </p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123; useState, useEffect &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Example</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">const</span> [count, setCount] = useState(<span class="number">0</span>);</div><div class="line">  <span class="comment">// Similar to componentDidMount and componentDidUpdate:</span></div><div class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">    <span class="comment">// Update the document title using the browser API</span></div><div class="line">    <span class="built_in">document</span>.title = <span class="string">`You clicked <span class="subst">$&#123;count&#125;</span> times`</span>;</div><div class="line">  &#125;);</div><div class="line">  <span class="keyword">return</span> (</div><div class="line">    &lt;div&gt;</div><div class="line">      &lt;p&gt;You clicked &#123;count&#125; times&lt;<span class="regexp">/p&gt;</span></div><div class="line"><span class="regexp">      &lt;button onClick=&#123;() =&gt; setCount(count + 1)&#125;&gt;</span></div><div class="line"><span class="regexp">        Click me</span></div><div class="line"><span class="regexp">      &lt;/</span>button&gt;</div><div class="line">    &lt;<span class="regexp">/div&gt;</span></div><div class="line"><span class="regexp">  );</span></div><div class="line"><span class="regexp">&#125;</span></div></pre></td></tr></table></figure>
<p>å½“ä½ è°ƒç”¨useEffectæ—¶ï¼Œç›¸å½“äºå‘Šè¯‰äº†Reactåœ¨åˆ·æ–°å¯¹DOMçš„æ›´æ”¹åå†è¿è¡Œä½ çš„â€œeffectâ€å‡½æ•°ã€‚Effectsæ˜¯å£°æ˜åœ¨Componentå†…çš„ï¼Œæ‰€ä»¥æœ‰æƒè®¿é—®ç»„ä»¶çš„propså’Œstateã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒReactåœ¨æ¯æ¬¡renderéƒ½ä¼šè°ƒç”¨effectsï¼ŒåŒ…æ‹¬ç¬¬ä¸€æ¬¡renderã€‚ï¼ˆæˆ‘ä»¬å°†æ›´å¤šåœ°è®¨è®ºä½¿ç”¨<a href="https://reactjs.org/docs/hooks-effect.html" target="_blank" rel="external">Effect Hook</a>å’Œclassä¸­çš„lifecyclesè¿›è¡Œæ¯”è¾ƒã€‚ï¼‰</p>
<p>Effectsè¿˜å¯ä»¥é€šè¿‡è¿”å›å‡½æ•°æŒ‡å®šå¦‚ä½•â€œæ¸…ç†â€å®ƒä»¬ã€‚ä¾‹å¦‚ï¼Œè¿™ä¸ªç»„ä»¶ä½¿ç”¨Effectæ¥è®¢é˜…æœ‹å‹çš„åœ¨çº¿çŠ¶æ€ï¼Œå¹¶é€šè¿‡å–æ¶ˆè®¢é˜…æ¥æ¸…ç†ï¼š<br><figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123;useState,useEffect&#125; <span class="keyword">from</span> <span class="string">'react'</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">FriendStatus</span>(<span class="params">props</span>)</span>&#123;</div><div class="line">  <span class="keyword">const</span> [isOnline,setIsOnline] = useState(<span class="literal">null</span>)</div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">handleStatusChange</span>(<span class="params">status</span>)</span>&#123;</div><div class="line">    setIsOnline(status.isOnline)</div><div class="line">  &#125;</div><div class="line">  useEffects(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</div><div class="line">      ChatAPI.subscribeToFriendStatus(props.friend.id, handleStatusChange);</div><div class="line">        <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">      ChatAPI.unsubscribeFromFriendStatus(props.friend.id, handleStatusChange);</div><div class="line">    &#125;;</div><div class="line">  &#125;)</div><div class="line">  <span class="keyword">if</span>(isOnline === <span class="literal">null</span>)&#123;</div><div class="line">    <span class="keyword">return</span> <span class="string">'loading'</span></div><div class="line">  &#125;</div><div class="line">   <span class="keyword">return</span> isOnline ? <span class="string">'Online'</span> :<span class="string">'Offline'</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒReactä¼šåœ¨ç»„ä»¶unmountæ—¶ï¼Œä»¥åŠåœ¨ç”±äºåç»­æ¸²æŸ“è€Œé‡æ–°è¿è¡Œeffectsä¹‹å‰å–æ¶ˆè®¢é˜…ChatAPIï¼ˆä½ ä¹Ÿå¯ä»¥å‘Šè¯‰React<a href="https://reactjs.org/docs/hooks-effect.html#tip-optimizing-performance-by-skipping-effects" target="_blank" rel="external">è·³è¿‡é‡æ–°è®¢é˜…</a>å¦‚æœæˆ‘ä»¬ä¼ ç»™ChatAPIçš„props.friend.idæ²¡æœ‰å˜çš„è¯ï¼‰</p>
<p>å°±åƒÂ·useStateÂ·ä¸€æ ·ï¼Œä½ å¯ä»¥åœ¨ä¸€ä¸ªComponentä¸­å¤šæ¬¡ä½¿ç”¨effect<br><figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">FriendStatusWithCounter</span>(<span class="params">props</span>) </span>&#123;</div><div class="line">  <span class="keyword">const</span> [count, setCount] = useState(<span class="number">0</span>);</div><div class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">    <span class="built_in">document</span>.title = <span class="string">`You clicked <span class="subst">$&#123;count&#125;</span> times`</span>;</div><div class="line">  &#125;);</div><div class="line"></div><div class="line">  <span class="keyword">const</span> [isOnline, setIsOnline] = useState(<span class="literal">null</span>);</div><div class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">    ChatAPI.subscribeToFriendStatus(props.friend.id, handleStatusChange);</div><div class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">      ChatAPI.unsubscribeFromFriendStatus(props.friend.id, handleStatusChange);</div><div class="line">    &#125;;</div><div class="line">  &#125;);</div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">handleStatusChange</span>(<span class="params">status</span>) </span>&#123;</div><div class="line">    setIsOnline(status.isOnline);</div><div class="line">  &#125;</div><div class="line">  <span class="comment">// ...</span></div></pre></td></tr></table></figure></p>
<p>Hookså…è®¸æ‚¨é€šè¿‡å“ªäº›éƒ¨åˆ†ç›¸å…³ï¼ˆä¾‹å¦‚æ·»åŠ å’Œåˆ é™¤è®¢é˜…ï¼‰æ¥ç»„ç»‡ç»„ä»¶ä¸­çš„side effectsï¼Œè€Œä¸æ˜¯åŸºäºç”Ÿå‘½å‘¨æœŸæ–¹æ³•å¼ºåˆ¶æ‹†åˆ†ã€‚<br>æ‚¨å¯ä»¥åœ¨è¿™ä¸ªé¡µé¢ä¸Šäº†è§£æœ‰å…³useEffectçš„æ›´å¤šä¿¡æ¯ï¼š<a href="https://reactjs.org/docs/hooks-effect.html" target="_blank" rel="external">Using the Effect Hook</a>ã€‚</p>
<h2 id="âœŒï¸-Rules-of-Hooks"><a href="#âœŒï¸-Rules-of-Hooks" class="headerlink" title="âœŒï¸ Rules of Hooks"></a>âœŒï¸ Rules of Hooks</h2><p>Hooksæ˜¯JavaScriptå‡½æ•°ï¼Œä½†å®ƒä»¬å¼ºåŠ äº†ä¸¤ä¸ªé¢å¤–çš„è§„åˆ™ï¼š</p>
<ul>
<li>åªèƒ½åœ¨é¡¶å±‚è°ƒç”¨Hooksã€‚ä¸è¦åœ¨å¾ªç¯ï¼Œæ¡ä»¶æˆ–åµŒå¥—å‡½æ•°ä¸­è°ƒç”¨Hookã€‚</li>
<li>ä»…ä»Reactå‡½æ•°ç»„ä»¶ä¸­è°ƒç”¨Hooksã€‚ä¸è¦ä»å¸¸è§„JavaScriptå‡½æ•°ä¸­è°ƒç”¨Hookã€‚ ï¼ˆè¿˜æœ‰å¦ä¸€ä¸ªæœ‰æ•ˆçš„åœ°æ–¹å«Hooks - ä½ è‡ªå·±çš„å®šåˆ¶Hooksã€‚æˆ‘ä»¬é©¬ä¸Šå°±ä¼šäº†è§£å®ƒä»¬ã€‚ï¼‰</li>
</ul>
<p>æˆ‘ä»¬æä¾›äº†ä¸€ä¸ª<a href="https://www.npmjs.com/package/eslint-plugin-react-hooks" target="_blank" rel="external">linteræ’ä»¶</a>æ¥è‡ªåŠ¨æ‰§è¡Œè¿™äº›è§„åˆ™ã€‚è¿™äº›è§„åˆ™æœ€åˆå¯èƒ½çœ‹èµ·æ¥æœ‰é™æˆ–ä»¤äººå›°æƒ‘ï¼Œä½†å®ƒä»¬å¯¹äºä½¿Hooksè¿è¡Œè‰¯å¥½è‡³å…³é‡è¦ã€‚</p>
<h2 id="ğŸ’¡-Custom-Hooks"><a href="#ğŸ’¡-Custom-Hooks" class="headerlink" title="ğŸ’¡ Custom Hooks"></a>ğŸ’¡ Custom Hooks</h2><p>æœ‰æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨ç»„ä»¶ä¹‹é—´é‡ç”¨ä¸€äº›æœ‰çŠ¶æ€é€»è¾‘ã€‚ä»¥å¾€ï¼Œè¿™ä¸ªé—®é¢˜æœ‰ä¸¤ç§æµè¡Œçš„è§£å†³æ–¹æ¡ˆï¼šHOCå’Œrender propsã€‚Custom Hookå¯ä»¥åšåˆ°è¿™äº›ï¼Œå¹¶ä¸”è®©ä½ ä¸éœ€å¾€ç»„ä»¶æ ‘æ·»åŠ æ›´å¤šçš„ç»„ä»¶ã€‚<br> åœ¨å‰é¢ï¼Œæˆ‘ä»¬ä»‹ç»äº†ä¸€ä¸ªè°ƒç”¨useStateå’ŒuseEffect Hooksçš„FriendStatusç»„ä»¶æ¥è®¢é˜…æœ‹å‹çš„åœ¨çº¿çŠ¶æ€ã€‚å‡è®¾æˆ‘ä»¬è¿˜å¸Œæœ›åœ¨å¦ä¸€ä¸ªç»„ä»¶ä¸­é‡ç”¨æ­¤è®¢é˜…é€»è¾‘ï¼š<br> é¦–å…ˆï¼Œæˆ‘ä»¬å°†è¿™ä¸ªé€»è¾‘æå–åˆ°ä¸€ä¸ªåä¸ºuseFriendStatusçš„è‡ªå®šä¹‰Hookä¸­ï¼š<br> <figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"> <span class="keyword">import</span> &#123; useState, useEffect &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">useFriendStatus</span>(<span class="params">friendID</span>) </span>&#123;</div><div class="line">  <span class="keyword">const</span> [isOnline, setIsOnline] = useState(<span class="literal">null</span>);</div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">handleStatusChange</span>(<span class="params">status</span>) </span>&#123;</div><div class="line">    setIsOnline(status.isOnline);</div><div class="line">  &#125;</div><div class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">    ChatAPI.subscribeToFriendStatus(friendID, handleStatusChange);</div><div class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">      ChatAPI.unsubscribeFromFriendStatus(friendID, handleStatusChange);</div><div class="line">    &#125;;</div><div class="line">  &#125;);</div><div class="line">  <span class="keyword">return</span> isOnline;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p> å®ƒå°†friendIDä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›æˆ‘ä»¬çš„æœ‹å‹æ˜¯å¦åœ¨çº¿ã€‚<br> ç°åœ¨æˆ‘ä»¬å¯ä»¥åœ¨ç»„ä»¶ä¸­ä½¿ç”¨å®ƒï¼š<br> <figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">FriendStatus</span>(<span class="params">props</span>) </span>&#123;</div><div class="line">  <span class="keyword">const</span> isOnline = useFriendStatus(props.friend.id);</div><div class="line"></div><div class="line">  <span class="keyword">if</span> (isOnline === <span class="literal">null</span>) &#123;</div><div class="line">    <span class="keyword">return</span> <span class="string">'Loading...'</span>;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> isOnline ? <span class="string">'Online'</span> : <span class="string">'Offline'</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">FriendListItem</span>(<span class="params">props</span>) </span>&#123;</div><div class="line">  <span class="keyword">const</span> isOnline = useFriendStatus(props.friend.id);</div><div class="line">  <span class="keyword">return</span> (</div><div class="line">    &lt;li style=&#123;&#123; <span class="attr">color</span>: isOnline ? <span class="string">'green'</span> : <span class="string">'black'</span> &#125;&#125;&gt;</div><div class="line">      &#123;props.friend.name&#125;</div><div class="line">    &lt;<span class="regexp">/li&gt;</span></div><div class="line"><span class="regexp">  );</span></div><div class="line"><span class="regexp">&#125;</span></div></pre></td></tr></table></figure></p>
<p> è¿™äº›ç»„ä»¶çš„çŠ¶æ€æ˜¯å®Œå…¨ç‹¬ç«‹çš„ã€‚Hooksæ˜¯é‡ç”¨æœ‰çŠ¶æ€é€»è¾‘çš„ä¸€ç§æ–¹å¼ï¼Œè€Œä¸æ˜¯çŠ¶æ€æœ¬èº«ã€‚äº‹å®ä¸Šï¼Œæ¯æ¬¡è°ƒç”¨Hookéƒ½æœ‰ä¸€ä¸ªå®Œå…¨éš”ç¦»çš„state - æ‰€ä»¥ä½ ç”šè‡³å¯ä»¥åœ¨ä¸€ä¸ªç»„ä»¶ä¸­ä½¿ç”¨ç›¸åŒçš„è‡ªå®šä¹‰Hookä¸¤æ¬¡ã€‚<br> Custom Hooksæ›´åƒæ˜¯ä¸€ç§çº¦å®šè€ŒéåŠŸèƒ½,å¦‚æœä¸€ä¸ªå‡½æ•°çš„åå­—ä»¥â€˜useâ€™å¼€å¤´ï¼ŒæŠŠé‚£ä¸ªä¸”ä»–è°ƒç”¨äº†å…¶ä»–çš„Hooks æˆ‘ä»¬ç§°ä»–ä¸ºcustom Hook ã€‚useSomethingå‘½åçº¦å®šä¹Ÿæ˜¯linteræ’ä»¶åœ¨ä½¿ç”¨äº†hooksçš„ä»£ç ä¸­æŸ¥æ‰¾bugçš„åŸç†ã€‚<br> æ‚¨å¯ä»¥ç¼–å†™è‡ªå®šä¹‰Hookï¼Œæ¶µç›–å„ç§ç”¨ä¾‹ï¼Œå¦‚è¡¨å•å¤„ç†ï¼ŒåŠ¨ç”»ï¼Œå£°æ˜æ€§è®¢é˜…ï¼Œè®¡æ—¶å™¨ï¼Œå¯èƒ½è¿˜æœ‰æ›´å¤šæˆ‘ä»¬æ²¡æœ‰è€ƒè™‘è¿‡çš„ã€‚æˆ‘ä»¬å¾ˆé«˜å…´çœ‹åˆ°Reactç¤¾åŒºæå‡ºçš„å®šåˆ¶Hooksã€‚</p>
<h2 id="ğŸ”Œ-Other-Hooks"><a href="#ğŸ”Œ-Other-Hooks" class="headerlink" title="ğŸ”Œ Other Hooks"></a>ğŸ”Œ Other Hooks</h2><p>æ‚¨å¯èƒ½ä¼šå‘ç°ä¸€äº›ä¸å¤ªå¸¸ç”¨çš„å†…ç½®Hookå¾ˆæœ‰ç”¨ã€‚ä¾‹å¦‚ï¼ŒuseContextå…è®¸æ‚¨è®¢é˜…Reactä¸Šä¸‹æ–‡è€Œä¸å¼•å…¥åµŒå¥—ï¼š<br><figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Example</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">const</span> locale = useContext(LocaleContext);</div><div class="line">  <span class="keyword">const</span> theme = useContext(ThemeContext);</div><div class="line">  <span class="comment">// ...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>useReducerå…è®¸æ‚¨ä½¿ç”¨reducerç®¡ç†å¤æ‚ç»„ä»¶çš„æœ¬åœ°çŠ¶æ€ï¼š<br><figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Todos</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">const</span> [todos, dispatch] = useReducer(todosReducer);</div><div class="line">  <span class="comment">// ...</span></div></pre></td></tr></table></figure></p>
<p>è¿™åªæ˜¯React å®˜ç½‘ä¸­å…³äºHooksçš„ä¸€ç¯‡å¤§æ¦‚çš„ä»‹ç»ï¼Œæ›´åŠ è¯¦ç»†çš„ä½¿ç”¨æ–‡æ¡£ï¼Œå¯ä»¥åœ¨å®˜æ–¹æ–‡æ¡£ä¸­è·å¾—ï¼š<a href="https://reactjs.org/docs/hooks-intro.html" target="_blank" rel="external">HOOKS(Proposal)</a></p>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2018-10-28</span><i class="fa fa-tag"></i><a class="tag" href="/tags/JS/" title="-JS">-JS </a></div></div></div></div><div class="share"><div class="evernote"><a class="fa fa-bookmark" href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank"></a></div><div class="weibo"><a class="fa fa-weibo" href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));"></a></div><div class="twitter"><a class="fa fa-twitter" href="http://twitter.com/home?status=,http://stan1812.github.io/2018/10/28/Hooks/,Libx,Hooks at a Glance,;"></a></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a class="btn" role="navigation" href="/2019/01/05/experience-engineering/" title="å‰ç«¯ã€è®¾è®¡ã€ç”¨æˆ·ä½“éªŒ">Post Anterior</a></li><li class="next pagbuttons"><a class="btn" role="navigation" href="/2018/10/25/Burning/" title="ç‡ƒçƒ§">PrÃ³ximo post</a></li></ul></div></div></div></div></div><script src="/js/jquery.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script></body></html>